#!/bin/sh
# Para Windows (Git Bash)
exec < /dev/tty

echo "=========================================="
echo "üîí SEGURAN√áA DE COMMIT - FaciliAuto"
echo "=========================================="
echo ""
echo "Verificando arquivos para commit..."
echo ""

# Verifica se .env existe
if [ -f .env ]; then
  echo "‚ùå ERRO CR√çTICO: .env detectado!"
  echo ""
  echo "NUNCA commite arquivos .env. Eles cont√™m segredos!"
  echo ""
  echo "A√ß√£o necess√°ria:"
  echo "  1. Remova .env: git rm --cached .env"
  echo "  2. Adicione ao .gitignore: echo '.env' >> .gitignore"
  echo "  3. Use .env.example como template"
  echo ""
  exit 1
fi

# Verifica tokens Groq
echo "üîç Procurando tokens Groq..."
if grep -r "gsk_[a-zA-Z0-9]" --include="*.js" --include="*.ts" --include="*.md" --include="*.json" --include="*.txt" . 2>/dev/null; then
  echo ""
  echo "‚ùå ERRO CR√çTICO: Token Groq detectado!"
  echo ""
  echo "REMOVA TODOS OS TOKENS DOS ARQUIVOS ANTES DE COMMITAR"
  echo ""
  echo "Solu√ß√£o:"
  echo "  1. Substitua tokens reais por placeholders"
  echo "  2. Use: GROQ_API_KEY="\${{GROQ_API_KEY}}""
  echo "  3. Defina tokens via Railway Variables"
  echo ""
  exit 1
fi
echo "‚úÖ Nenhum token Groq detectado"
echo ""

# Verifica tokens Meta
echo "üîç Procurando tokens Meta..."
if grep -r "EAAAA" --include="*.js" --include="*.ts" --include="*.md" --include="*.json" --include="*.txt" . 2>/dev/null; then
  echo ""
  echo "‚ùå ERRO CR√çTICO: Token Meta detectado!"
  echo ""
  echo "REMOVA TODOS OS TOKENS DOS ARQUIVOS ANTES DE COMMITAR"
  echo ""
  echo "Solu√ß√£o:"
  echo "  1. Substitua tokens reais por placeholders"
  echo "  2. Use: META_WHATSAPP_TOKEN="\${{META_WHATSAPP_TOKEN}}""
  echo "  3. Defina tokens via Railway Variables"
  echo ""
  exit 1
fi
echo "‚úÖ Nenhum token Meta detectado"
echo ""

# Verifica vari√°veis chave
echo "üîç Verificando vari√°veis de ambiente..."
if grep -rE "(API_KEY|SECRET|TOKEN|PWD|PASSWORD)=[a-zA-Z0-9]{20,}" --include="*.js" --include="*.ts" --include="*.md" --include="*.json" --include="*.txt" . 2>/dev/null; then
  echo ""
  echo "‚ùå ERRO: Vari√°vel sens√≠vel detectada!"
  echo ""
  echo "NUNMA hardcode credenciais no c√≥digo"
  echo ""
  exit 1
fi
echo "‚úÖ Nenhum segredo hardcoded"
echo ""

echo "=========================================="
echo "‚úÖ VERIFICA√á√ÉO DE SEGURAN√áA: OK"
echo "=========================================="
echo ""
echo "Pronto para commit! üöÄ"
echo ""
exit 0